{% extends 'base.html' %}
{% block content %}
  <div class="breadcrumb">
    <a href="{{ url_for('index') }}">/</a>
    {% set parts = (current_path|string).split('/') %}
    {% set ns = namespace(acc="") %}
    {% for seg in parts %}
      {% set ns.acc = ns.acc ~ ('' if ns.acc == '' else '/') ~ seg %}
      / <a href="{{ url_for('view_folder', subpath=ns.acc) }}">{{ seg }}</a>
    {% endfor %}
  </div>

  <section class="card" style="margin-bottom: 16px;">
    {% if index_md %}
      <h2 style="margin-top:0;">{{ index_md.title or 'Folder' }}</h2>
      {% if index_md.description %}
        <p class="muted">{{ index_md.description }}</p>
      {% endif %}
      {% if index_md.body %}
        <div class="md" style="margin-top:8px;">{{ index_md.body | e | replace('\n','<br>') | safe }}</div>
      {% endif %}
      <hr style="border:0;border-top:1px solid var(--border); margin: 14px 0;">
    {% endif %}
    <form class="upload" action="{{ url_for('upload_to_folder', subpath=current_path) }}" method="post" enctype="multipart/form-data">
      <label for="file"><strong>Upload image to this folder:</strong></label>
      <input class="input" type="file" id="file" name="file" accept="image/*" required>
      <button class="button" type="submit">Upload</button>
      <span class="muted">Allowed: .jpg, .jpeg, .png, .gif, .webp, .bmp, .tiff (max 25MB)</span>
    </form>
  </section>

  <section class="card" style="margin-bottom: 16px;">
    <h2 style="margin-top:0;">Subfolders</h2>
    <ul class="list">
      {% for rel in subdirs %}
        <li><a href="{{ url_for('view_folder', subpath=rel) }}">/{{ rel }}</a></li>
      {% else %}
        <li class="muted"><em>No subfolders.</em></li>
      {% endfor %}
    </ul>
  </section>

  <section class="card">
    <h2 style="margin-top:0;">Images</h2>
    <div class="grid">
      {% for rel in images %}
        <figure>
          <a href="{{ url_for('serve_content', filepath=rel) }}" target="_blank" rel="noopener">
            <img src="{{ url_for('serve_content', filepath=rel) }}" alt="{{ rel }}" />
          </a>
          <figcaption>
            <code>{{ rel }}</code>
          </figcaption>
        </figure>
      {% else %}
        <p class="muted"><em>No images in this folder.</em></p>
      {% endfor %}
    </div>
  </section>
{% endblock %}
